<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Prepease ‚Äî Order Online (Cash on Delivery)</title>
<meta name="description" content="Prepease sauces & spreads. Order online with Cash on Delivery.">
<style>
  :root{
    --brand:#ff4d2d;--brand-2:#ffb703;--ink:#1d1d1f;--muted:#5f6368;
    --bg:#fffdf8;--card:#ffffff;--line:#ece7df;--ok:#129c5d;--danger:#c62828;
    --shadow:0 10px 30px rgba(0,0,0,.06);--radius:14px;--radius-sm:10px;--max:1200px;
  }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  img{max-width:100%;display:block} a{color:var(--brand);text-decoration:none}
  .container{max-width:var(--max);margin:auto;padding:0 20px} .btn{display:inline-flex;align-items:center;gap:.6rem;background:var(--brand);color:#fff;border:none;border-radius:999px;padding:.75rem 1.1rem;font-weight:700;cursor:pointer;box-shadow:var(--shadow);transition:.2s}
  .btn:hover{opacity:.95;transform:translateY(-1px)} .btn.secondary{background:#111} .btn.ghost{background:#fff;color:#111;border:1px solid var(--line)}
  .badge{display:inline-block;padding:.35rem .6rem;border:1px solid var(--line);border-radius:999px;font-size:.8rem;color:var(--muted);background:#fff}
  .grid{display:grid;gap:18px} .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:50}
  .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
  .brand{display:flex;align-items:center;gap:.7rem;font-weight:800}
  .logo{inline-size:30px;block-size:30px;border-radius:8px;background:conic-gradient(from 200deg,var(--brand),var(--brand-2));box-shadow:var(--shadow)}
  nav ul{display:flex;gap:.7rem;list-style:none;margin:0;padding:0} nav a{padding:.5rem .7rem;border-radius:999px} nav a:hover{background:#f6efe6}
  .menu{display:none}.nav-cta{display:flex;gap:.5rem;align-items:center}
  .pill{display:inline-flex;align-items:center;gap:.35rem;background:#fff;border:1px solid var(--line);border-radius:999px;padding:.45rem .7rem;font-size:.82rem}
  .hero{padding:52px 0 26px;background:radial-gradient(1200px 500px at 75% -50%, rgba(255,183,3,.25), transparent 70%), radial-gradient(1000px 500px at -10% 10%, rgba(255,77,45,.15), transparent 70%)}
  .hero-wrap{display:grid;grid-template-columns:1.2fr .8fr;gap:24px;align-items:center}
  .headline{font-size:clamp(1.8rem,3.5vw,3rem);line-height:1.15;margin:.2rem 0 .6rem}
  .sub{color:var(--muted);font-size:1.05rem;max-width:50ch}
  .hero-img{aspect-ratio:4/3;border-radius:var(--radius);border:1px solid var(--line);display:grid;place-items:center;background:linear-gradient(135deg,#fff,#fff4e7 35%, #ffe7e0);padding:10px}
  .hero-img .mock{aspect-ratio:4/3;border-radius:12px;border:2px dashed #ffc7b9;display:grid;place-items:center;color:#c24e2b;font-weight:700;width:100%}
  .section{padding:48px 0} .section h2{margin:0 0 12px;font-size:clamp(1.4rem,2.3vw,2rem)}
  .products{grid-template-columns:repeat(3,1fr)} .product{padding:14px;display:grid;gap:10px}
  .product .img{aspect-ratio:4/3;border-radius:12px;border:1px solid var(--line);display:grid;place-items:center;background:linear-gradient(135deg,#fff7f3,#ffe3da);font-weight:700;color:#c24e2b}
  .row{display:flex;justify-content:space-between;align-items:center;gap:.6rem;flex-wrap:wrap}
  .price{font-weight:800} .strike{color:#777;text-decoration:line-through;font-weight:500;margin-left:.4rem}
  .qty{display:flex;align-items:center;gap:.35rem} .qty button{border:1px solid var(--line);background:#fff;border-radius:8px;padding:.3rem .55rem;cursor:pointer}
  .drawer{position:fixed;inset:0 0 0 auto;max-width:420px;width:92vw;background:#fff;border-left:1px solid var(--line);translate:100% 0;transition:.35s;z-index:70;box-shadow:-10px 0 30px rgba(0,0,0,.1);display:flex;flex-direction:column}
  .drawer.show{translate:0 0} .drawer header{position:sticky;top:0}
  .cart-items{padding:14px;display:grid;gap:10px;overflow:auto;flex:1}
  .cart-empty{color:#666;text-align:center;padding:22px}
  .mini-line{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;border:1px solid var(--line);border-radius:12px;padding:10px}
  .mini-img{inline-size:56px;block-size:46px;border-radius:8px;border:1px solid var(--line);display:grid;place-items:center;background:#fff7f1;color:#c24e2b;font-size:.8rem}
  .checkout{padding:14px;border-top:1px solid var(--line);display:grid;gap:10px}
  .tot{display:flex;justify-content:space-between} .muted{color:#777}
  .stepper{display:grid;gap:14px}
  form.checkout-form{display:grid;gap:10px} input,select,textarea{width:100%;padding:.8rem;border:1px solid var(--line);border-radius:12px;background:#fff}
  textarea{min-height:90px;resize:vertical}
  .msg{font-weight:700} .msg.ok{color:var(--ok)} .msg.err{color:var(--danger)}
  .pill-list{display:flex;gap:.4rem;flex-wrap:wrap}
  .admin{padding:16px;border:1px dashed #e5d8c9;border-radius:12px;background:#fff}
  footer{padding:24px 0;border-top:1px solid var(--line);color:#555}
  @media (max-width:960px){.hero-wrap{grid-template-columns:1fr}.products{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:680px){nav ul{display:none}.menu{display:inline-block}.products{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <span>Prepease</span>
        <span class="badge">Cash on Delivery</span>
      </div>
      <nav>
        <ul>
          <li><a href="#home">Home</a></li>
          <li><a href="#featured">Products</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </nav>
      <div class="nav-cta">
        <button class="btn ghost" onclick="openCart()" aria-label="Open cart">üõí <span id="cartCount">0</span></button>
        <button class="menu btn" onclick="document.querySelector('nav ul').style.display='flex'">‚ò∞</button>
      </div>
    </div>
  </header>

  <main id="home">
    <section class="hero">
      <div class="container hero-wrap">
        <div>
          <h1 class="headline">Restaurant-Quality Taste. <br>Order Now ‚Äî <u>Cash on Delivery</u>.</h1>
          <p class="sub">Chef-crafted sauces & spreads for pizzas, sandwiches, and snacks. 100% vegetarian, no preservatives, ready-to-use.</p>
          <div class="pill-list" style="margin:.8rem 0 0">
            <span class="pill">üë®‚Äçüç≥ Chef-Crafted</span>
            <span class="pill">üå± 100% Veg</span>
            <span class="pill">‚ö° Ready in minutes</span>
          </div>
          <div style="margin-top:14px;display:flex;gap:.7rem;flex-wrap:wrap">
            <a class="btn" href="#featured">Shop Products</a>
            <button class="btn secondary" onclick="openCart()">View Cart</button>
          </div>
        </div>
        <div class="hero-img"><div class="mock">Swap in product photo</div></div>
      </div>
    </section>

    <!-- Products -->
    <section class="section" id="featured">
      <div class="container">
        <h2>Products</h2>
        <div id="productGrid" class="grid products"></div>
        <div class="admin" style="margin-top:16px">
          <b>Store Owner Tips</b>
          <ul style="margin:.4rem 0 0 1rem">
            <li>Replace WhatsApp & Email in the script constants.</li>
            <li>Edit product prices/stock in <code>PRODUCTS</code>.</li>
            <li>Orders save locally and can be exported or sent via WhatsApp/Email.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Contact -->
    <section class="section" id="contact">
      <div class="container">
        <h2>Contact</h2>
        <div class="grid" style="grid-template-columns:1fr 1fr">
          <div class="card" style="padding:14px">
            <p>üìß <a href="mailto:support@prepease.in">support@prepease.in</a></p>
            <p>üìû <a href="tel:+91XXXXXXXXXX">+91-XXXX-XXXXXX</a></p>
            <p>üìç Nagpur, India</p>
            <p class="sub">Business hours: Mon‚ÄìSat, 10:00‚Äì18:00 IST</p>
          </div>
          <div class="card" style="padding:14px">
            <h3>Wholesale / B2B</h3>
            <p>Need bulk packs for restaurants or cloud kitchens? We offer commercial sizes and samples.</p>
            <button class="btn" onclick="openCart(); setTimeout(()=>startCheckout(), 250)">Request Sample via Checkout</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Cart / Checkout Drawer -->
  <aside id="drawer" class="drawer" aria-hidden="true" aria-label="Cart and Checkout">
    <header style="background:#fff;border-bottom:1px solid var(--line)">
      <div class="container nav" style="height:auto;padding:10px 14px">
        <div style="font-weight:800">üõí Your Cart</div>
        <button class="btn ghost" onclick="closeCart()">Close</button>
      </div>
    </header>

    <div class="cart-items" id="cartItems"></div>

    <div class="checkout">
      <div id="summary" class="tot"><span>Subtotal</span><b>‚Çπ0</b></div>
      <div class="tot"><span class="muted">Shipping</span><span id="shipFee" class="muted">‚Çπ0</span></div>
      <div class="tot"><span class="muted">COD Fee</span><span id="codFee" class="muted">‚Çπ0</span></div>
      <div class="tot"><b>Total</b><b id="grand">‚Çπ0</b></div>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap">
        <button class="btn" onclick="startCheckout()">Proceed to Checkout</button>
        <button class="btn ghost" onclick="clearCart()">Clear Cart</button>
      </div>

      <!-- Checkout Stepper -->
      <div id="checkoutStep" class="stepper" style="display:none">
        <hr style="border:none;border-top:1px solid var(--line)">
        <h3>Checkout ‚Äî Cash on Delivery</h3>
        <form id="checkoutForm" class="checkout-form" onsubmit="return placeOrder(event)">
          <div class="grid" style="grid-template-columns:1fr 1fr">
            <input name="name" placeholder="Full Name*" required>
            <input name="phone" placeholder="Phone*" inputmode="tel" required>
          </div>
          <input type="email" name="email" placeholder="Email (optional)">
          <div class="grid" style="grid-template-columns:1fr 1fr">
            <input name="pincode" placeholder="Pincode*" required>
            <input name="city" placeholder="City*" required>
          </div>
          <textarea name="address" placeholder="Full Address*" required></textarea>
          <div class="grid" style="grid-template-columns:1fr 1fr">
            <select name="state" required>
              <option value="" disabled selected>State*</option>
              <option>Maharashtra</option><option>Karnataka</option><option>Delhi</option>
              <option>Gujarat</option><option>Tamil Nadu</option><option>Telangana</option>
              <option>Other</option>
            </select>
            <select name="slot" required>
              <option value="" disabled selected>Delivery Preference*</option>
              <option>Standard (3‚Äì5 days)</option>
              <option>Express (1‚Äì2 days)</option>
            </select>
          </div>

          <!-- Payment (COD only) -->
          <div class="card" style="padding:10px">
            <label style="display:flex;align-items:center;gap:.5rem">
              <input type="radio" name="payment" value="COD" checked> <b>Cash on Delivery (COD)</b>
            </label>
            <p class="muted" style="margin:.4rem 0 0">Pay in cash when your order arrives. A small COD fee may apply.</p>
          </div>

          <div class="grid" style="grid-template-columns:1fr 1fr">
            <input name="coupon" placeholder="Coupon code (optional)">
            <button type="button" class="btn ghost" onclick="applyCoupon()">Apply Coupon</button>
          </div>

          <label style="display:flex;align-items:center;gap:.5rem">
            <input type="checkbox" name="agree" required> I agree to the Terms & Privacy.
          </label>

          <div style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center">
            <button class="btn" type="submit">Place Order (COD)</button>
            <span id="checkMsg" class="msg" aria-live="polite" role="status"></span>
          </div>

          <div class="muted" style="font-size:.9rem">
            After placing your order, you can **send it to us** via WhatsApp or Email with one tap.
          </div>
        </form>
      </div>
    </div>
  </aside>

  <!-- Order Success Modal -->
  <dialog id="successModal" style="border:none;border-radius:14px;max-width:720px;width:95vw">
    <div class="card" style="padding:16px">
      <h3>üéâ Order Placed (COD)</h3>
      <p>Thank you! Your order has been saved. Our team will confirm shortly.</p>
      <div id="orderSummary" class="card" style="padding:12px;margin:10px 0"></div>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap">
        <a id="waLink" class="btn" target="_blank" rel="nofollow">Send via WhatsApp</a>
        <a id="mailLink" class="btn secondary">Send via Email</a>
        <button class="btn ghost" onclick="downloadOrder()">Download JSON</button>
        <button class="btn ghost" onclick="window.print()">Print</button>
      </div>
      <div class="muted" style="margin-top:8px">Tip: Replace our store contact placeholders in the code with your WhatsApp number & email to receive orders directly.</div>
      <div style="margin-top:12px;display:flex;gap:.6rem;flex-wrap:wrap">
        <button class="btn" onclick="closeSuccess()">Done</button>
        <button class="btn ghost" onclick="openCart()">Back to Cart</button>
      </div>
    </div>
  </dialog>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap">
      <div>¬© <span id="year"></span> Prepease</div>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap">
        <a href="#featured">Products</a> ¬∑ <a href="#contact">Contact</a> ¬∑ <a href="#" onclick="viewLocalOrders()">View Saved Orders (this device)</a>
      </div>
    </div>
  </footer>

<script>
/* ==========================
   CONFIG ‚Äî replace these!
========================== */
const STORE_WHATSAPP = "91XXXXXXXXXX"; // e.g., "919876543210" (no +)
const STORE_EMAIL = "orders@yourdomain.com";

/* ==========================
   Sample Product Catalog
========================== */
const PRODUCTS = [
  { id:"PZ-SCHEZZA-250", name:"Schezza Base (Schezwan Pizza Redimix) 250g", price:179, mrp:199, img:"Schezza Base", stock:50 },
  { id:"PZ-SCHEZZA-500", name:"Schezza Base 500g", price:329, mrp:359, img:"Schezza Base", stock:40 },
  { id:"SD-SCHEZZO-250", name:"Schezzo Spread (Schezwan Sandwich Premix) 250g", price:169, mrp:189, img:"Schezzo Spread", stock:60 },
  { id:"PZ-TANDOOR-250", name:"Tandoori Flame Pizza Base 250g", price:189, mrp:209, img:"Tandoori Flame", stock:50 },
  { id:"PZ-ROYAL-250", name:"Royal Tikka Pizza Base 250g", price:199, mrp:219, img:"Royal Tikka", stock:38 },
  { id:"SD-TGRILL-250", name:"Tandoori Grill Sandwich Spread 250g", price:169, mrp:189, img:"Tandoori Grill", stock:55 },
  { id:"SD-HERIT-250", name:"Heritage Tikka Sandwich Spread 250g", price:179, mrp:199, img:"Heritage Tikka", stock:52 }
];

/* Fees/Coupons */
const SHIPPING_THRESHOLD = 499;    // Free shipping above this
const SHIPPING_FEE = 49;           // Otherwise this fee
const COD_FEE = 25;                // Flat COD fee
const VALID_COUPONS = { "PREP10": 0.10, "FREESHIP": "FREESHIP" };

const $ = (q,root=document)=>root.querySelector(q);
const $$ = (q,root=document)=>[...root.querySelectorAll(q)];

const state = {
  cart: JSON.parse(localStorage.getItem("prepease_cart")||"[]"),
  coupon: null,
  totals: { subtotal:0, shipping:0, cod:0, discount:0, grand:0 },
  lastOrder: null
};

function money(n){ return "‚Çπ"+n.toFixed(0) }

/* Render products */
function renderProducts(){
  const wrap = $("#productGrid");
  wrap.innerHTML = "";
  PRODUCTS.forEach(p=>{
    const el = document.createElement("article");
    el.className = "card product";
    el.innerHTML = `
      <div class="img">${p.img}</div>
      <h3>${p.name}</h3>
      <div class="row">
        <div>
          <span class="price">${money(p.price)}</span>
          <span class="strike">${money(p.mrp)}</span>
        </div>
        <span class="badge">In stock: ${p.stock}</span>
      </div>
      <div class="row">
        <div class="qty">
          <button aria-label="Decrease" onclick='stepQty("${p.id}",-1)'>‚àí</button>
          <input id="qty-${p.id}" type="number" min="1" value="1" style="width:60px;padding:.4rem;border:1px solid var(--line);border-radius:8px">
          <button aria-label="Increase" onclick='stepQty("${p.id}",1)'>+</button>
        </div>
        <button class="btn" onclick='addToCart("${p.id}")'>Add to Cart</button>
      </div>`;
    wrap.appendChild(el);
  });
}
function stepQty(id,dir){
  const input = $("#qty-"+id);
  const v = Math.max(1, parseInt(input.value||"1")+dir);
  input.value = v;
}

/* Cart ops */
function addToCart(id){
  const p = PRODUCTS.find(x=>x.id===id);
  const qty = parseInt($("#qty-"+id)?.value||"1");
  if(!p) return;
  const line = state.cart.find(x=>x.id===id);
  const finalQty = Math.min(qty + (line?line.qty:0), p.stock);
  if(line) line.qty = finalQty; else state.cart.push({id,qty:finalQty,price:p.price,name:p.name});
  persistCart(); renderCart(); openCart();
}
function changeCartQty(id,delta){
  const line = state.cart.find(x=>x.id===id);
  if(!line) return;
  const p = PRODUCTS.find(x=>x.id===id);
  line.qty = Math.max(1, Math.min(line.qty+delta, p.stock));
  persistCart(); renderCart();
}
function removeFromCart(id){
  state.cart = state.cart.filter(x=>x.id!==id);
  persistCart(); renderCart();
}
function clearCart(){
  state.cart = []; persistCart(); renderCart();
}
function persistCart(){ localStorage.setItem("prepease_cart", JSON.stringify(state.cart)); updateCartCount(); }

function updateCartCount(){
  $("#cartCount").textContent = state.cart.reduce((a,b)=>a+b.qty,0);
}

/* Drawer */
function openCart(){ const d=$("#drawer"); d.classList.add("show"); d.setAttribute("aria-hidden","false"); renderCart(); }
function closeCart(){ const d=$("#drawer"); d.classList.remove("show"); d.setAttribute("aria-hidden","true"); }

/* Summary calc */
function calcTotals(){
  const subtotal = state.cart.reduce((s,l)=>s + l.qty*l.price, 0);
  let discount = 0, shipping = 0;
  if(state.coupon && VALID_COUPONS[state.coupon]){
    const v = VALID_COUPONS[state.coupon];
    if(v==="FREESHIP") shipping = 0; else discount = subtotal * v;
  }
  if(subtotal - discount < SHIPPING_THRESHOLD){ shipping = (VALID_COUPONS[state.coupon]==="FREESHIP")?0:SHIPPING_FEE; }
  const cod = state.cart.length ? COD_FEE : 0;
  const grand = Math.max(0, Math.round(subtotal - discount + shipping + cod));
  state.totals = { subtotal:Math.round(subtotal), shipping, cod, discount:Math.round(discount), grand };
}

/* Render cart */
function renderCart(){
  const list = $("#cartItems");
  if(!state.cart.length){
    list.innerHTML = `<div class="cart-empty">Your cart is empty.</div>`;
  } else {
    list.innerHTML = "";
    state.cart.forEach(l=>{
      const p = PRODUCTS.find(x=>x.id===l.id);
      const item = document.createElement("div");
      item.className = "mini-line";
      item.innerHTML = `
        <div class="mini-img">${p.img}</div>
        <div>
          <div style="font-weight:700">${l.name||p.name}</div>
          <div class="muted">${p.id}</div>
          <div class="row" style="margin-top:6px">
            <div class="qty">
              <button onclick='changeCartQty("${l.id}",-1)'>‚àí</button>
              <span style="min-width:24px;text-align:center">${l.qty}</span>
              <button onclick='changeCartQty("${l.id}",1)'>+</button>
            </div>
            <div>${money(l.qty*l.price)}</div>
          </div>
        </div>
        <button class="btn ghost" onclick='removeFromCart("${l.id}")'>Remove</button>
      `;
      list.appendChild(item);
    });
  }
  calcTotals();
  $("#summary").innerHTML = `<span>Subtotal ${state.totals.discount?`(‚àí${money(state.totals.discount)} coupon)`:''}</span><b>${money(state.totals.subtotal - state.totals.discount)}</b>`;
  $("#shipFee").textContent = money(state.totals.shipping);
  $("#codFee").textContent = money(state.totals.cod);
  $("#grand").textContent = money(state.totals.grand);
}

/* Checkout */
function startCheckout(){
  if(!state.cart.length){ alert("Add items to cart first."); return; }
  $("#checkoutStep").style.display = "block";
  $("#drawer").scrollTo({top:9999,behavior:"smooth"});
}
function applyCoupon(){
  const code = ($("#checkoutForm [name=coupon]")?.value||"").trim().toUpperCase();
  const msg = $("#checkMsg");
  if(!code){ msg.className="msg err"; msg.textContent="Enter a code."; return; }
  if(!VALID_COUPONS[code]){ msg.className="msg err"; msg.textContent="Invalid code."; return; }
  state.coupon = code; renderCart(); msg.className="msg ok"; msg.textContent=`Applied ${code}.`;
}

/* Validation helpers */
function validPhone(s){ return /^[0-9]{10}$/.test((s||"").replace(/\D/g,"")) }
function validPin(s){ return /^[1-9][0-9]{5}$/.test((s||"").trim()) }

function placeOrder(e){
  e.preventDefault();
  const f = new FormData(e.target);
  const data = Object.fromEntries(f.entries());
  const msg = $("#checkMsg");

  if(!validPhone(data.phone)){ msg.className="msg err"; msg.textContent="Enter a valid 10-digit phone."; return false; }
  if(!validPin(data.pincode)){ msg.className="msg err"; msg.textContent="Enter a valid 6-digit pincode."; return false; }
  if(!data.agree){ msg.className="msg err"; msg.textContent="Please agree to the terms."; return false; }

  // Compose order
  const orderId = "PE" + Date.now().toString().slice(-8);
  const items = state.cart.map(l=>{
    const p = PRODUCTS.find(x=>x.id===l.id);
    return { sku:l.id, name:p.name, qty:l.qty, price:l.price, line_total:l.qty*l.price };
  });
  const order = {
    order_id: orderId,
    created_at: new Date().toISOString(),
    payment: "COD",
    coupon: state.coupon,
    totals: state.totals,
    customer: {
      name: data.name, phone: data.phone, email: data.email||"",
      address: data.address, city: data.city, state: data.state, pincode: data.pincode,
      slot: data.slot
    },
    items
  };

  // Save locally
  const all = JSON.parse(localStorage.getItem("prepease_orders")||"[]");
  all.push(order);
  localStorage.setItem("prepease_orders", JSON.stringify(all));
  state.lastOrder = order;

  // Clear cart
  clearCart();
  $("#checkoutStep").style.display = "none";
  $("#checkMsg").textContent = "";

  // Show confirmation
  showSuccess(order);
  return false;
}

function showSuccess(order){
  const box = $("#orderSummary");
  const lines = order.items.map(i=>`‚Ä¢ ${i.name} √ó ${i.qty} = ${money(i.line_total)}`).join("<br>");
  box.innerHTML = `
    <b>Order ID:</b> ${order.order_id}<br>
    <b>Payment:</b> ${order.payment}<br>
    <b>Total:</b> ${money(order.totals.grand)}<br>
    <b>Customer:</b> ${order.customer.name}, ${order.customer.phone}<br>
    <b>Address:</b> ${order.customer.address}, ${order.customer.city} ${order.customer.pincode}, ${order.customer.state}<br>
    <b>Items:</b><br>${lines}
  `;

  // Links
  const text = encodeURIComponent(composeOrderText(order));
  const wa = `https://wa.me/${STORE_WHATSAPP}?text=${text}`;
  const subj = encodeURIComponent(`New COD Order ${order.order_id} ‚Äî ${order.customer.name}`);
  const body = text;
  const mail = `mailto:${encodeURIComponent(STORE_EMAIL)}?subject=${subj}&body=${body}`;

  $("#waLink").href = wa;
  $("#mailLink").href = mail;

  const dlg = $("#successModal");
  if(typeof dlg.showModal==="function"){ dlg.showModal(); }
  else { alert("Order placed!\n\nOpen WhatsApp/Email buttons to send order to store."); }
}
function closeSuccess(){
  const dlg = $("#successModal");
  if(dlg.open) dlg.close();
}

function composeOrderText(o){
  const items = o.items.map(i=>`${i.name} x ${i.qty} = ${i.line_total}`).join("%0A");
  return `New COD Order ${o.order_id}%0A%0A`+
         `Customer: ${o.customer.name}%0APhone: ${o.customer.phone}%0AEmail: ${o.customer.email||"-"}%0A`+
         `Address: ${o.customer.address}, ${o.customer.city} ${o.customer.pincode}, ${o.customer.state}%0A`+
         `Delivery: ${o.customer.slot}%0A%0A`+
         `Items:%0A${items}%0A%0A`+
         `Subtotal: ${o.totals.subtotal} - Discount: ${o.totals.discount}%0A`+
         `Shipping: ${o.totals.shipping} + COD: ${o.totals.cod}%0A`+
         `Total: ${o.totals.grand}%0A`;
}

function downloadOrder(){
  const o = state.lastOrder;
  if(!o) return;
  const blob = new Blob([JSON.stringify(o,null,2)],{type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${o.order_id}.json`;
  a.click();
  URL.revokeObjectURL(a.href);
}

/* Utility: view saved orders (local) */
function viewLocalOrders(){
  const arr = JSON.parse(localStorage.getItem("prepease_orders")||"[]");
  if(!arr.length){ alert("No saved orders on this device yet."); return; }
  const text = arr.map(o=>`${o.order_id} ‚Äî ${o.customer.name} ‚Äî ${o.totals.grand}`).join("\n");
  alert("Saved Orders (this device):\n\n"+text+"\n\nUse the success screen to export/WhatsApp/Email each order.");
}

/* Init */
function init(){
  renderProducts(); renderCart(); updateCartCount();
  $("#year").textContent = new Date().getFullYear();
}
window.addEventListener("load", init);
</script>
</body>
</html>
